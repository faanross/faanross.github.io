<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Section 7: Post-Mortem Forensics - Traffic Analysis - faan|ross</title><link rel="icon" type="image/x-icon" href=/favicon.ico /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="| Return to Course Overview | Proceed to Section 8 |
7. Post-Mortem Forensics: Traffic Analysis 7.1. Introduction Hunting in the realm of traffic can be extremely challenging given the scale, hwoever it&rsquo;s also the one domain where, however difficult, the answer is always sure to be found.
Why? Well as once again Chris Benson likes to say: it&rsquo;s the one place malware cannot hide. Malware can find incredivbly sophistiaceted ways to obscure its presence in memory, it can find creative ways to avoid/delete logging, but it has to generate packets." />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="Section 7: Post-Mortem Forensics - Traffic Analysis" />
<meta property="og:description" content="| Return to Course Overview | Proceed to Section 8 |
7. Post-Mortem Forensics: Traffic Analysis 7.1. Introduction Hunting in the realm of traffic can be extremely challenging given the scale, hwoever it&rsquo;s also the one domain where, however difficult, the answer is always sure to be found.
Why? Well as once again Chris Benson likes to say: it&rsquo;s the one place malware cannot hide. Malware can find incredivbly sophistiaceted ways to obscure its presence in memory, it can find creative ways to avoid/delete logging, but it has to generate packets." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://athul.github.io/archie/course01/07_post_traffic/" /><meta property="article:section" content="course01" />
<meta property="article:published_time" content="2023-08-12T02:01:58+05:30" />
<meta property="article:modified_time" content="2023-08-12T02:01:58+05:30" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Section 7: Post-Mortem Forensics - Traffic Analysis"/>
<meta name="twitter:description" content="| Return to Course Overview | Proceed to Section 8 |
7. Post-Mortem Forensics: Traffic Analysis 7.1. Introduction Hunting in the realm of traffic can be extremely challenging given the scale, hwoever it&rsquo;s also the one domain where, however difficult, the answer is always sure to be found.
Why? Well as once again Chris Benson likes to say: it&rsquo;s the one place malware cannot hide. Malware can find incredivbly sophistiaceted ways to obscure its presence in memory, it can find creative ways to avoid/delete logging, but it has to generate packets."/>
<script src="https://athul.github.io/archie/js/feather.min.js"></script>
	
	
        <link href="https://athul.github.io/archie/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://athul.github.io/archie/css/main.ed21e2343a948b7213db7c2893a1b95027c5acaafa446a8586de799d014fce06.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://athul.github.io/archie/css/dark.191767dd42068cd77e23d5f95ccc0becc0e7105decd65e1405e5695f242e2b3c.css"   />
	

	
	
		<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
		</script>
	
		
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script>
	

	
	
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
		
		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
					renderMathInElement(document.body, {
							delimiters: [
									{left: "$$", right: "$$", display: true},
									{left: "$", right: "$", display: false}
							]
					});
			});
			</script>
	
	
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://athul.github.io/archie/">faan|ross</a>
	</div>
	<nav>
		
		<a href="/archie/">Home</a>
		
		<a href="/archie/about">About</a>
		
		<a href="/archie/posts">Posts</a>
		
		<a href="/archie/tags">Tags</a>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">Section 7: Post-Mortem Forensics - Traffic Analysis</h1>
			<div class="meta">Posted on Aug 12, 2023</div>
		</div>
		

		<section class="body">
			<p><code>|</code> <a href="https://www.faanross.com/posts/course01/">Return to Course Overview</a> <code>|</code> <a href="https://www.faanross.com/course01/08_review/">Proceed to Section 8</a> <code>|</code></p>
<hr>
<p> </p>
<h1 id="7-post-mortem-forensics-traffic-analysis">7. Post-Mortem Forensics: Traffic Analysis</h1>
<h1 id="71-introduction">7.1. Introduction</h1>
<p>Hunting in the realm of traffic can be extremely challenging given the scale, hwoever it&rsquo;s also the one domain where, however difficult, the answer is always sure to be found.</p>
<p>Why? Well as once again Chris Benson likes to say: it&rsquo;s the one place malware cannot hide. Malware can find incredivbly sophistiaceted ways to obscure its presence in memory, it can find creative ways to avoid/delete logging, but it has to generate packets. And if it does not generate packets, it means it is not communicating.</p>
<p>is in some respect</p>
<p>&hellip; truth -</p>
<p>As Chris Benson like</p>
<p>talk about why abbrevuiated</p>
<h1 id="traffic-analysis">TRAFFIC ANALYSIS</h1>
<h1 id="introduction">Introduction</h1>
<p>traffic analyssius one of most powerful ways to do threat hunting
but like every tool has strenghts and weaknesses</p>
<p>our specific investaition here, analyzing ane vent that was basicalkly only the initiiaal foothold, its weakness.</p>
<p>For Traffic Analysis cIntroductyion
LIMITATION of traffic in this scenarion</p>
<ul>
<li>mention here that it&rsquo;s strength not really as much as others in deteceting intiail actions. Traffic is not great for finding individual actions, it&rsquo;s great for finding emergent patterns (time, session size etc), usually the longer period the better.</li>
</ul>
<p>Here we only simulated an initial comprmoise, we did not really maintain a long perdio (1 day +) etc, communciating with server, sharing data etc. So</p>
<ul>
<li>
<p>first do the Threat Hunting Level 1 course</p>
</li>
<li>
<p>then do the Chris Benton traffic analysis</p>
</li>
<li>
<p>Let&rsquo;s first rerun attack (remember to drop cmd etc)</p>
</li>
<li>
<p>redo pcap with just that</p>
</li>
<li>
<p>then let&rsquo;s do threat hunting level 1, other vid courses teaching about c2 in traffic logs etc.</p>
</li>
</ul>
<h1 id="for-now-redo-pcap-so-cleaner">FOR NOW REDO PCAP SO CLEANER</h1>
<p>Ok our bew pcap has 584
first things of  interest seem to be 58 +59 - DNS query for the web server
we can look into second one and we can see that the ip for the URL was 185.199.108.133</p>
<p>then we see a whole series of convos between our IP and that IP, making connection, checking certs (TLS) etc</p>
<p>then 116 we can see ARP asking for IP of attacker, clearly now scipt has been injected and malware seeking to make conneciton back</p>
<p>117 we can see response</p>
<p>then from 118 on we can see long convo between the two - victim and attacker</p>
<p>let&rsquo;s follow convo see what&rsquo;s intersrting</p>
<ul>
<li>immediately what do we see? PE header - magic bytes + DOS stub</li>
<li>then about 1/3 of way in we see what looks like a series of runtime errors</li>
</ul>
<p><a href="https://www.first.org/resources/papers/conference2010/cummings-slides.pdf">https://www.first.org/resources/papers/conference2010/cummings-slides.pdf</a></p>
<p>we see some strings, google it above
can we save it and search it with YARA rule??</p>
<p>no, no positive hits with YARA</p>
<p>for now, let&rsquo;s abandon this since sidetrack</p>
<p>we can see it in course, find interesting, but say outside of scopt</p>
<p>we create a new folder, this is where output will go
we navigate to folder
we run the command
[full path to zeek] -r [full path to pcap]</p>
<p>analyst@analyst:~/Desktop/zeeklogs$ /opt/zeek/bin/zeek -r ~/Desktop/new_capture.pcapng</p>
<p>when we do this it generates 6 logs</p>
<p>+++++++++++++++++++++++++++++++++++</p>
<p>First, build a case mode UII</p>
<p>Second, Pareto Principle logging.</p>
<ul>
<li>
<p>mention this one usualyl more realm of SOC/SIEM and not Forensics, which usually more focus of threat hutning.</p>
</li>
<li>
<p>Likely one of the thoughts underpinning this attitude is that logs are grunt-work, mountains of nothing that needs to be sifted through, mountains so huge its completly beyond the scope of humams, and so SIEMs not only CAN do it, but are better than humans in it.</p>
</li>
<li>
<p>but that is true for the general appraco to logs. But what we are speaking of here is a much specific way of looking at logs - limitiing the type of logs we look at. Additioarnlly, logs depending on the PHASE. See below - logs might not be a great place to start in Phase 1, but for example can be perfect for Phase 2. Sicne you already more or less know what you are looking for, makes the volume manageable, esp considering we&rsquo;re likely only interested in Sysmon, Powershell, and a highly select WEL IDs.</p>
</li>
</ul>
<p>ULTIMATELY, Phase 1 should focus on where they cannot hide - meaning memory and packets. Every where else, disk, logs, etc they can hide. but they can never hide from memory/packets = memory when they are at rest/use, packets when they are in transit.</p>
<p>Ok so now as we go ahead, remember we have no idea of the attack, we don&rsquo;t know a DLL injected attack has happened, since that was &ldquo;evil ash&rdquo; doing it. Meaning we are in Phase 1, and then thios I might not mention but for own sanity - at end of live analysis II (PE Hacker), we can then switch over to Phase II.</p>
<p>Will be using same VM here, victim, in practice we would bnever do this,.</p>
<p> </p>
<hr>
<p><code>|</code> <a href="https://www.faanross.com/posts/course01/">Return to Course Overview</a> <code>|</code> <a href="https://www.faanross.com/course01/08_review/">Proceed to Section 8</a> <code>|</code></p>

		</section>

		<div class="post-tags">
			
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/faanross" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a><a class="soc" href="https://twitter.com/faanross" rel="me" title="Twitter"><i data-feather="twitter"></i></a>
    <a class="border"></a><a class="soc" href="https://www.youtube.com/channel/UCtwchzdOYHiXai5BxXPiHMg" rel="me" title="YouTube"><i data-feather="youtube"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2023  | hack the planet |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
  feather.replace()
</script></div>
    </body>
</html>
